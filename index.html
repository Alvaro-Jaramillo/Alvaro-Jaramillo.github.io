<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Industry News Dashboard</title>
    <meta name="description" content="Top news from your selected sites" />
    <link rel="stylesheet" href="assets/style.css" />
  </head>
  <body>
    
    <div style="background: linear-gradient(90deg,#6ab0ff,#4a90e2); padding:20px; text-align:center; border-bottom:4px solid #22242b;">
      <h1 style="margin:0; font-size:32px; font-weight:800; color:white; text-shadow:1px 1px 4px rgba(0,0,0,0.4);">
        AJ's Automation Links!
      </h1>
    </div>

    <div class="container">
      <div class="header">
        <div class="title">Industry News Dashboard</div>
        <div class="controls">
          <input id="q" type="search" placeholder="Filter titles and descriptions..." />
          <select id="sort">
            <option value="published_desc">Newest first</option>
            <option value="published_asc">Oldest first</option>
            <option value="title_asc">Title A→Z</option>
            <option value="title_desc">Title Z→A</option>
          </select>
        </div>
        <div class="sources" id="sources"></div>
      </div>

      <div class="grid" id="grid"></div>

      <div class="footer">
        Updated 2025-08-19 00:19 UTC · Generated by GitHub Actions
      </div>
    </div>

    <script>
      const grid = document.getElementById('grid');
      const q = document.getElementById('q');
      const sort = document.getElementById('sort');
      const sourceWrap = document.getElementById('sources');

      let all = [];
      let selectedSources = new Set();

      async function load() {
        const res = await fetch('data/articles.json?_=' + Date.now());
        const data = await res.json();
        all = data.articles || [];
        const sources = [...new Set(all.map(a => a.source))].sort();
        sources.forEach(s => {
          const id = 'src-' + s.replace(/[^a-z0-9]+/gi, '-').toLowerCase();
          const chip = document.createElement('label');
          chip.className = 'source-chip';
          chip.innerHTML = '<input type="checkbox" id="' + id + '" checked /> ' + s + ' <span class="badge">' + all.filter(a => a.source === s).length + '</span>';
          sourceWrap.appendChild(chip);
          document.getElementById(id).addEventListener('change', e => {
            if (e.target.checked) selectedSources.add(s); else selectedSources.delete(s);
            render();
          });
          selectedSources.add(s);
        });
        render();
      }

      function render() {
        const term = (q.value || '').trim().toLowerCase();
        let items = all.filter(a => selectedSources.has(a.source));
        if (term) {
          items = items.filter(a => (a.title + ' ' + (a.description || '')).toLowerCase().includes(term));
        }
        const [key, dir] = sort.value.split('_');
        items.sort((a, b) => {
          if (key === 'published') {
            const da = new Date(a.published || 0).getTime();
            const db = new Date(b.published || 0).getTime();
            return dir === 'asc' ? da - db : db - da;
          }
          if (key === 'title') {
            return dir === 'asc' ? a.title.localeCompare(b.title) : b.title.localeCompare(a.title);
          }
          return 0;
        });

        grid.innerHTML = items.map(a => `
          <div class="card">
            <div class="source">${a.source}</div>
            <a href="${a.link}" target="_blank" rel="noopener">
              <div class="title">${a.title}</div>
            </a>
            ${a.description ? `<div class="desc">${a.description}</div>` : ''}
            ${a.published ? `<div class="desc">Published: ${new Date(a.published).toLocaleString()}</div>` : ''}
          </div>
        `).join('');
      }

      q.addEventListener('input', render);
      sort.addEventListener('change', render);
      load();
    </script>
  </body>
</html>